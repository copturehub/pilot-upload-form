<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <title>Filuppladdning - Copture</title>
</head>
<body>
  <h1>Ladda upp flygfiler till Copture</h1>

  <label>Pilotnamn:
    <input type="text" id="pilot" required>
  </label><br>

  <label>Projektnamn:
    <input type="text" id="project" required>
  </label><br>

  <label>Filer:
    <input type="file" id="files" multiple required>
  </label><br>

  <button onclick="upload()">Ladda upp</button>

  <div id="status" style="margin-top: 20px; font-family: monospace;"></div>

  <script>
    async function upload() {
      const pilot = document.getElementById("pilot").value.trim();
      const project = document.getElementById("project").value.trim();
      const files = document.getElementById("files").files;
      const status = document.getElementById("status");

      if (!pilot || !project || files.length === 0) {
        status.innerText = "⚠️ Fyll i alla fält och välj filer.";
        return;
      }

      const formData = new FormData();

      for (const file of files) {
        formData.append("file", file); // UploadThing kräver "file"
      }

      // Skicka även med route till rätt endpoint
      formData.append("route", "pilotUploader");

      try {
        const response = await fetch("/api/uploadthing", {
          method: "POST",
          body: formData
        });

        const result = await response.text();
        status.innerText = "✅ Svar från servern: " + result;
        console.log(result);
      } catch (err) {
        status.innerText = "❌ Fel vid uppladdning: " + err.message;
        console.error(err);
      }
    }
  </script>
</body>
</html>
